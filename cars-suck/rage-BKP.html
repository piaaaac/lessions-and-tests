<!--  

--------------------------
Improvements
--------------------------
mascherare carrozzeria
salvare linee
suono

-->

<!DOCTYPE html>
<html>
  <head>
    <title>CARS SUCK</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
    <link rel="stylesheet" href="stile.css">
  </head>
<body>

<div id="previews">
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00003.jpg" id="00003" data-mask-src="images/rage/00003_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00004.jpg" id="00004" data-mask-src="images/rage/00004_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00001.jpg" id="00001" data-mask-src="images/rage/00001_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00006.jpg" id="00006" data-mask-src="images/rage/00006_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00002.jpg" id="00002" data-mask-src="images/rage/00002_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00005.jpg" id="00005" data-mask-src="images/rage/00005_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00009.jpg" id="00009" data-mask-src="images/rage/00009_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00008.jpg" id="00008" data-mask-src="images/rage/00008_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00010.jpg" id="00010" data-mask-src="images/rage/00010_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00011.jpg" id="00011" data-mask-src="images/rage/00011_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00012.jpg" id="00012" data-mask-src="images/rage/00012_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00007.jpg" id="00007" data-mask-src="images/rage/00007_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00013.jpg" id="00013" data-mask-src="images/rage/00013_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00014.jpg" id="00014" data-mask-src="images/rage/00014_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00015.jpg" id="00015" data-mask-src="images/rage/00015_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00016.jpg" id="00016" data-mask-src="images/rage/00016_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00017.jpg" id="00017" data-mask-src="images/rage/00017_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00018.jpg" id="00018" data-mask-src="images/rage/00018_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00019.jpg" id="00019" data-mask-src="images/rage/00019_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00020.jpg" id="00020" data-mask-src="images/rage/00020_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00021.jpg" id="00021" data-mask-src="images/rage/00021_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00022.jpg" id="00022" data-mask-src="images/rage/00022_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00023.jpg" id="00023" data-mask-src="images/rage/00023_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00024.jpg" id="00024" data-mask-src="images/rage/00024_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00025.jpg" id="00025" data-mask-src="images/rage/00025_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00026.jpg" id="00026" data-mask-src="images/rage/00026_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00027.jpg" id="00027" data-mask-src="images/rage/00027_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00028.jpg" id="00028" data-mask-src="images/rage/00028_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00029.jpg" id="00029" data-mask-src="images/rage/00029_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00030.jpg" id="00030" data-mask-src="images/rage/00030_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00031.jpg" id="00031" data-mask-src="images/rage/00031_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00032.jpg" id="00032" data-mask-src="images/rage/00032_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00033.jpg" id="00033" data-mask-src="images/rage/00033_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00034.jpg" id="00034" data-mask-src="images/rage/00034_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00035.jpg" id="00035" data-mask-src="images/rage/00035_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00036.jpg" id="00036" data-mask-src="images/rage/00036_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00037.jpg" id="00037" data-mask-src="images/rage/00037_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00038.jpg" id="00038" data-mask-src="images/rage/00038_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00039.jpg" id="00039" data-mask-src="images/rage/00039_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00040.jpg" id="00040" data-mask-src="images/rage/00040_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00041.jpg" id="00041" data-mask-src="images/rage/00041_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00042.jpg" id="00042" data-mask-src="images/rage/00042_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00043.jpg" id="00043" data-mask-src="images/rage/00043_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00044.jpg" id="00044" data-mask-src="images/rage/00044_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00045.jpg" id="00045" data-mask-src="images/rage/00045_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00046.jpg" id="00046" data-mask-src="images/rage/00046_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00047.jpg" id="00047" data-mask-src="images/rage/00047_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00048.jpg" id="00048" data-mask-src="images/rage/00048_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00049.jpg" id="00049" data-mask-src="images/rage/00049_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00050.jpg" id="00050" data-mask-src="images/rage/00050_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00051.jpg" id="00051" data-mask-src="images/rage/00051_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00052.jpg" id="00052" data-mask-src="images/rage/00052_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00053.jpg" id="00053" data-mask-src="images/rage/00053_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00054.jpg" id="00054" data-mask-src="images/rage/00054_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00055.jpg" id="00055" data-mask-src="images/rage/00055_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00056.jpg" id="00056" data-mask-src="images/rage/00056_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00057.jpg" id="00057" data-mask-src="images/rage/00057_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00058.jpg" id="00058" data-mask-src="images/rage/00058_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00059.jpg" id="00059" data-mask-src="images/rage/00059_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00060.jpg" id="00060" data-mask-src="images/rage/00060_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00061.jpg" id="00061" data-mask-src="images/rage/00061_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00062.jpg" id="00062" data-mask-src="images/rage/00062_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00063.jpg" id="00063" data-mask-src="images/rage/00063_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00064.jpg" id="00064" data-mask-src="images/rage/00064_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00065.jpg" id="00065" data-mask-src="images/rage/00065_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00066.jpg" id="00066" data-mask-src="images/rage/00066_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00067.jpg" id="00067" data-mask-src="images/rage/00067_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00068.jpg" id="00068" data-mask-src="images/rage/00068_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00069.jpg" id="00069" data-mask-src="images/rage/00069_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00070.jpg" id="00070" data-mask-src="images/rage/00070_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00071.jpg" id="00071" data-mask-src="images/rage/00071_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00072.jpg" id="00072" data-mask-src="images/rage/00072_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00073.jpg" id="00073" data-mask-src="images/rage/00073_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00074.jpg" id="00074" data-mask-src="images/rage/00074_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00075.jpg" id="00075" data-mask-src="images/rage/00075_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00076.jpg" id="00076" data-mask-src="images/rage/00076_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00077.jpg" id="00077" data-mask-src="images/rage/00077_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00078.jpg" id="00078" data-mask-src="images/rage/00078_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00079.jpg" id="00079" data-mask-src="images/rage/00079_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00080.jpg" id="00080" data-mask-src="images/rage/00080_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00081.jpg" id="00081" data-mask-src="images/rage/00081_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00082.jpg" id="00082" data-mask-src="images/rage/00082_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00083.jpg" id="00083" data-mask-src="images/rage/00083_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00084.jpg" id="00084" data-mask-src="images/rage/00084_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00085.jpg" id="00085" data-mask-src="images/rage/00085_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00086.jpg" id="00086" data-mask-src="images/rage/00086_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00087.jpg" id="00087" data-mask-src="images/rage/00087_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00088.jpg" id="00088" data-mask-src="images/rage/00088_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00089.jpg" id="00089" data-mask-src="images/rage/00089_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00090.jpg" id="00090" data-mask-src="images/rage/00090_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00091.jpg" id="00091" data-mask-src="images/rage/00091_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00092.jpg" id="00092" data-mask-src="images/rage/00092_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00093.jpg" id="00093" data-mask-src="images/rage/00093_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00094.jpg" id="00094" data-mask-src="images/rage/00094_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00095.jpg" id="00095" data-mask-src="images/rage/00095_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00096.jpg" id="00096" data-mask-src="images/rage/00096_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00097.jpg" id="00097" data-mask-src="images/rage/00097_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00098.jpg" id="00098" data-mask-src="images/rage/00098_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00099.jpg" id="00099" data-mask-src="images/rage/00099_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00100.jpg" id="00100" data-mask-src="images/rage/00100_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00101.jpg" id="00101" data-mask-src="images/rage/00101_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00102.jpg" id="00102" data-mask-src="images/rage/00102_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00103.jpg" id="00103" data-mask-src="images/rage/00103_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00104.jpg" id="00104" data-mask-src="images/rage/00104_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00105.jpg" id="00105" data-mask-src="images/rage/00105_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00106.jpg" id="00106" data-mask-src="images/rage/00106_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00107.jpg" id="00107" data-mask-src="images/rage/00107_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00108.jpg" id="00108" data-mask-src="images/rage/00108_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00109.jpg" id="00109" data-mask-src="images/rage/00109_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00110.jpg" id="00110" data-mask-src="images/rage/00110_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00111.jpg" id="00111" data-mask-src="images/rage/00111_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00112.jpg" id="00112" data-mask-src="images/rage/00112_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00113.jpg" id="00113" data-mask-src="images/rage/00113_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00114.jpg" id="00114" data-mask-src="images/rage/00114_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00115.jpg" id="00115" data-mask-src="images/rage/00115_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00116.jpg" id="00116" data-mask-src="images/rage/00116_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00117.jpg" id="00117" data-mask-src="images/rage/00117_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00118.jpg" id="00118" data-mask-src="images/rage/00118_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00119.jpg" id="00119" data-mask-src="images/rage/00119_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00120.jpg" id="00120" data-mask-src="images/rage/00120_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00121.jpg" id="00121" data-mask-src="images/rage/00121_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00122.jpg" id="00122" data-mask-src="images/rage/00122_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00123.jpg" id="00123" data-mask-src="images/rage/00123_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00124.jpg" id="00124" data-mask-src="images/rage/00124_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00125.jpg" id="00125" data-mask-src="images/rage/00125_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00126.jpg" id="00126" data-mask-src="images/rage/00126_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00127.jpg" id="00127" data-mask-src="images/rage/00127_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00128.jpg" id="00128" data-mask-src="images/rage/00128_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00129.jpg" id="00129" data-mask-src="images/rage/00129_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00130.jpg" id="00130" data-mask-src="images/rage/00130_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00131.jpg" id="00131" data-mask-src="images/rage/00131_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00132.jpg" id="00132" data-mask-src="images/rage/00132_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00133.jpg" id="00133" data-mask-src="images/rage/00133_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00134.jpg" id="00134" data-mask-src="images/rage/00134_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00135.jpg" id="00135" data-mask-src="images/rage/00135_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00136.jpg" id="00136" data-mask-src="images/rage/00136_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00137.jpg" id="00137" data-mask-src="images/rage/00137_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00138.jpg" id="00138" data-mask-src="images/rage/00138_mask.jpg" /></div>
  <div class="preview"><img onclick="openCar(this);" src="images/rage/00139.jpg" id="00139" data-mask-src="images/rage/00139_mask.jpg" /></div>
</div>

<div id="p5-container"></div>

<a id="close-btn" onclick="resetUI();" href="#"></a>

<script type="text/javascript">

// -----------------------------------------
// State
// -----------------------------------------

var state = {
  openImageEl: null,
  scratchActive: false,
}

// -----------------------------------------
// Events
// -----------------------------------------

document.addEventListener('keydown', evt => {
  if (evt.key === 'Escape') {
    resetUI();
  }
});

// -----------------------------------------
// JS
// -----------------------------------------

function resetUI () {
  if (state.openImageEl !== null) {
    closeImage(state.openImageEl);
  }
}  

function openCar (el) {
  if (state.openImageEl !== null) return;

  var previews = document.querySelector("#previews");
  var r = el.getBoundingClientRect();
  console.log(r)
  var large = el.cloneNode();
  large.className = "large";
  document.body.append(large);
  large.style.left = r.x +"px";
  large.style.top = r.y +"px";

  // remember return parameters: x, y, scale
  large.dataset.closeLeftPx = r.x;
  large.dataset.closeTopPx = r.y;

  // calculate new parameters
  var ratioWindow = window.innerWidth / window.innerHeight;
  var ratioImg = r.width / r.height;    
  var scale;
  if (ratioImg > ratioWindow) {
    // make img height equal to window height
    scale = window.innerHeight/large.clientHeight;
  } else {
    // make img width equal to window width
    scale = window.innerWidth/large.clientWidth;
  }

  setTimeout(() => {
    large.style.transform = "scale("+ scale +")";
    large.style.left = (window.innerWidth/2 - r.width/2) +"px";
    large.style.top = (window.innerHeight/2 - r.height/2) +"px";

    state.openImageEl = large;
    document.body.classList.add("image-open");
    state.scratchActive = true;
  })
}

function closeImage (el) {
  state.scratchActive = false;
  el.style.left = el.dataset.closeLeftPx +"px";
  el.style.top = el.dataset.closeTopPx +"px";
  el.style.transform = "scale(1)";
  el.style.opacity = 0;
  document.body.classList.remove("image-open");
  
  setTimeout(() => {
    el.remove();
    state.openImageEl = null;
  }, 400)
}

// -----------------------------------------
// P5
// -----------------------------------------

var lineData;
var alreadyDrawing = false;

let sketch = function(p) {

  p.setup = function () {
    var c = p.createCanvas(p.windowWidth, p.windowHeight);
    c.parent("p5-container");
  }

  p.drawCar = function (url) {
    p.loadImage(url, function (img) {
      p.image(img, 0, 0, 200, 200)
    }, function (error) {
      console.log("Error loading image, error");
    })
  }

  p.draw = function () {
    if (state.scratchActive) {
      if (p.mouseIsPressed) {
        
        // --- scratch
        p.stroke(0, 150);
        p.line(p.pmouseX - 0.5, p.pmouseY - 0.5, p.mouseX - 0.5, p.mouseY - 0.5);
        p.stroke(128, 150);
        p.line(p.pmouseX + 0, p.pmouseY + 0, p.mouseX + 0, p.mouseY + 0);
        p.stroke(255, 150);
        p.line(p.pmouseX + 0.5, p.pmouseY + 0.5, p.mouseX + 0.5, p.mouseY + 0.5);
        
        // --- update line memory -------------
        if (!alreadyDrawing) { // first point
          lineData = [[p.pmouseX, p.pmouseY]];
        }
        lineData.push([p.mouseX, p.mouseY]); // current point
        // ------------------------------------
      } else {
        // --- store line data ----------------
        if (alreadyDrawing) { // just stopped drawing
          var imgId = state.openImageEl.id;
          var storageKey = "carssuck-lines-"+ imgId;
          console.log(storageKey)

          // later use a txt or smth
          var storageItem = window.localStorage.getItem(storageKey);
          var thisIdLines = (storageItem === null) ? [] : JSON.parse(storageItem);
          console.log(thisIdLines);

          thisIdLines.push(lineData);
          window.localStorage.setItem(storageKey, JSON.stringify(thisIdLines));
        }
        // ------------------------------------
      }
    } else {
      p.clear();
    }
    alreadyDrawing = state.scratchActive && p.mouseIsPressed;
  }
}

let p5Sketch = new p5(sketch);

</script>
</body>
</html>